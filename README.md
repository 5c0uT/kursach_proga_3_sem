# Kursach - Автоматизированный проектировщик сборок упругих муфт

## Описание

Kursach представляет собой комплексное приложение, разработанное на языке C++, которое воплощает принцип автоматизации инженерного проектирования через интеграцию с системой параметрического моделирования КОМПАС-3D. Проект демонстрирует синтез между фундаментальными принципами машиностроения и современными компьютерными технологиями, позволяя перенести процесс создания сложных механических узлов из традиционной сферы ручного проектирования в область алгоритмического описания и автоматической генерации геометрических моделей.

Приложение обеспечивает генерацию детальных трёхмерных моделей упругих муфт, валов, шпонок и крепёжных элементов на основе входных параметров, заданных пользователем. Архитектура программы построена на принципах разделения ответственности и модульности, что позволяет добиться высокой степени переиспользуемости кода и облегчить его сопровождение.

## Философское обоснование

В контексте современной инженерной практики данный проект олицетворяет переход от парадигмы "проектирования от чертежа" к парадигме "проектирования от параметра". Это отражает фундаментальное изменение в подходе к созданию технических объектов: вместо статичного представления формы через набор чертежей, мы оперируем динамичной моделью, где форма является производной от структурированного набора числовых характеристик и логических отношений между ними.

Философское содержание этого подхода коренится в идеях формализма и конструктивизма, где сложность возникает из простоты посредством четко определённых правил. Каждый параметр — это не просто число, а концептуальный элемент в описании целого, а каждый алгоритм построения компонента — это манифестация инженерного знания и опыта, кодифицированная в виде логических инструкций.

## Обзор проекта

Приложение предоставляет интуитивный пользовательский интерфейс для спецификации параметров упругих муфт и автоматически генерирует трёхмерные сборки, содержащие все необходимые компоненты и подсборки. Система опирается на КОМПАС-3D API для выполнения низкоуровневых операций с геометрией и использует JSON-ориентированное хранилище конфигурации для управления параметрическими таблицами.

Ключевая идея, лежащая в основе проекта, заключается в осознании того факта, что проектирование механических узлов подчиняется определённым правилам совместимости: не все комбинации параметров являются физически и технологически допустимыми. Система реализует эту сложную логику через механизм фильтрации и валидации параметров, основанный на предварительно подготовленных таблицах взаимной совместимости.

## Основные возможности

- Интерактивная настройка параметров упругих муфт с динамической валидацией
- Автоматическая фильтрация зависимых параметров на основе таблиц совместимости
- Генерация трёхмерных моделей с использованием КОМПАС-3D API
- Поддержка нескольких типов механических компонентов:
  - Упругие муфты (муфты) с полностью настраиваемыми геометрическими размерами
  - Полые валы (валы) с пазами под шпонку
  - Шпоночные элементы (шпонки) для передачи крутящего момента
  - Крепёжные винты (винты) с параметрической вариабельностью в зависимости от диаметра вала
  - Упорные кольца (кольца) для конфигураций, требующих осевой фиксации
- Автоматическая композиция полной сборки в формате КОМПАС
- JSON-ориентированное хранилище параметров с поддержкой динамической загрузки
- Механизм обнаружения и обработки ошибок с диагностическими сообщениями

## Структура проекта и архитектурная организация

```
Kursach/
|
|-- Builders/                           # Ядро генерации трёхмерных моделей
|   |
|   |-- CAssemblyBuilder.h/cpp         # Строитель сборок (паттерн Builder)
|   |                                  # Отвечает за композицию всех компонентов
|   |                                  # в единую геометрическую структуру
|   |
|   |-- CMuftaBuilder.h/cpp            # Генератор упругих муфт
|   |                                  # Реализует алгоритмы построения
|   |                                  # геометрии муфты на основе параметров
|   |
|   |-- CValBuilder.h/cpp              # Генератор валов
|   |                                  # Создаёт полые валы с пазами
|   |
|   |-- CShponkaBuilder.h/cpp          # Генератор шпонок
|   |                                  # Генерирует крепёжные элементы
|   |
|   |-- CKolcoBuilder.h/cpp            # Генератор упорных колец
|   |                                  # Создаёт кольца при необходимости
|   |
|   |-- CVintBuilder.h/cpp             # Генератор крепёжных винтов
|   |                                  # Параметрическая генерация винтов
|   |
|   |-- CValBuilder.h/cpp              # Дополнительный строитель валов
|
|-- CObjectMufta.h/cpp                 # Диалоговый интерфейс для муфт
|   |                                  # Реализует паттерн Model-View-Controller
|   |                                  # Загружает параметры из JSON
|   |                                  # Осуществляет фильтрацию параметров
|
|-- CObjectShponka.h/cpp               # Диалоговый интерфейс для шпонок
|-- CObjectVal.h/cpp                   # Диалоговый интерфейс для валов
|
|-- CMyFreeView.h/cpp                  # Пользовательский вьюпорт
|   |                                  # Позволяет расширить стандартные
|   |                                  # возможности просмотра
|
|-- MainFrm.h/cpp                      # Главное окно приложения
|   |                                  # Управляет жизненным циклом
|
|-- Kursach_View.h/cpp                 # Первичное представление приложения
|   |                                  # Содержит логику инициализации
|   |                                  # и управления КОМПАС-3D
|
|-- Kursach_Doc.h/cpp                  # Документ (модель данных)
|   |                                  # Хранит состояние приложения
|
|-- Kursach.h/cpp                      # Класс приложения
|   |                                  # Точка входа и управление ресурсами
|
|-- mufta_data.h/cpp                   # Структуры данных для муфт
|   |                                  # Содержит определения структур
|   |                                  # для хранения параметров
|
|-- mufta_data.json                    # Таблица параметров муфт
|   |                                  # JSON-представление всех допустимых
|   |                                  # комбинаций параметров
|
|-- Config.h                           # Конфигурационные константы
|-- pch.h                              # Предкомпилируемые заголовки
|-- framework.h                        # Фреймворк MFC
|
|-- KompasAssembly/                    # Директория вывода для 3D-моделей
|   |                                  # Сюда сохраняются все сгенерированные
|   |                                  # файлы в формате КОМПАС
|
|-- Kursach.sln                        # Файл решения Visual Studio
|-- .git/                              # Версионный контроль
|-- .vs/                               # Конфигурация Visual Studio
|-- .gitignore                         # Правила игнорирования Git
```

## Требования к системе

- Операционная система: Windows 10 и выше (архитектура x64)
- Среда разработки: Visual Studio 2019 или более поздняя версия с поддержкой C++
- КОМПАС-3D версии 5.x или более поздняя (обязательна для работы приложения)
- Библиотека nlohmann/json для обработки JSON (включена в проект)
- Microsoft Foundation Classes (MFC) для построения пользовательского интерфейса
- COM-инфраструктура операционной системы для интеграции с API
- .NET Framework для некоторых элементов MFC

## Зависимости и внешние компоненты

- KOMPAS-3D Software Development Kit (файлы kAPI5.tlh и kAPI5.tli)
- Библиотека nlohmann JSON для сериализации и десериализации данных
- MFC-фреймворк для разработки пользовательского интерфейса
- Windows COM (Component Object Model) для вызова методов КОМПАС-3D
- Стандартная библиотека C++ (STL) для работы с контейнерами и потоками

## Процесс компиляции и сборки проекта

1. Откройте файл решения `Kursach.sln` в среде Visual Studio 2019 или более поздней версии
2. Убедитесь, что выбрана конфигурация x64 (либо Debug для разработки, либо Release для production)
3. Установите КОМПАС-3D на машину разработки (необходимо для успешной компиляции)
4. Выполните сборку решения через меню Build или нажав Ctrl+Shift+B
5. Проверьте отсутствие ошибок компиляции в окне Output
6. Готовый исполняемый файл будет расположен в:
   - `x64/Debug/Kursach.exe` для конфигурации Debug
   - `x64/Release/Kursach.exe` для конфигурации Release

Примечание: КОМПАС-3D должен быть установлен на машине разработки. При отсутствии инсталляции компиляция завершится с ошибками линкования при попытке разрешить символы API.

## Инструкции по использованию

### Запуск приложения

1. Запустите скомпилированный исполняемый файл `Kursach.exe`
2. Приложение инициализирует себя и проверяет наличие необходимых директорий

### Процесс проектирования сборки

1. **Выбор типов компонентов**: В главном окне приложения отметьте флажками компоненты, которые должны входить в сборку (муфта, вал, шпонка и т.д.)

2. **Настройка параметров муфты**: Перейдите в диалоговое окно параметров муфты. Система предоставит комбо-боксы для выбора следующих параметров:
   - d (диаметр внутренний)
   - dt2 (диаметр промежуточный)
   - b (ширина)
   - b1 (дополнительная ширина)
   - d1 (диаметр крепёжного элемента)
   - D (диаметр внешний)
   - D1 (дополнительный диаметр)
   - L (длина)
   - l (локальная длина)
   - r (радиус скругления)
   - c (зазор)
   - c1 (дополнительный зазор)

3. **Динамическая валидация**: При выборе одного параметра система автоматически фильтрует допустимые значения для остальных параметров, обеспечивая соответствие таблице совместимости

4. **Спецификация вала**: Укажите параметры вала (длину, размеры пазов для шпонки)

5. **Выполнение построения**: Нажмите кнопку "Построить" для инициации процесса генерации моделей

6. **Результаты генерации**: Система создаст следующие файлы в директории `KompasAssembly/`:
   - `Mufta.m3d` - Трёхмерная модель упругой муфты
   - `Val.m3d` - Модель вала с пазами
   - `Shponka.m3d` - Модель шпоночного элемента
   - `Vint.m3d` - Модель крепёжного винта
   - `Kolco.m3d` - Модель упорного кольца (если требуется)
   - `ItogProdgect.a3d` - Полная сборка всех компонентов

## Конфигурация параметров и таблицы совместимости

### Формат и структура JSON

Все параметры упругих муфт загружаются из файла `mufta_data.json` при инициализации приложения. Файл имеет следующую структуру:

```json
{
  "MuftaData": {
    "Var": [
      [9.0, 10.4, 3.0, 0.0, 4.0, 16.0, 0.0, 35.0, 8.0, 0.1, 0.6, 0.5],
      [10.0, 11.4, 3.0, 0.0, 4.0, 16.0, 0.0, 35.0, 8.0, 0.1, 0.6, 0.5],
      ...
    ],
    "NameArrays": {
      "d": ["9.0", "10.0", "11.0", ...],
      "dt2": ["10.4", "11.4", "12.8", ...],
      "b": ["3.0", "4.0", "5.0", ...],
      "b1": ["0.0", "1.0", "1.2"],
      "d1": ["4.0", "6.0"],
      "D": ["16.0", "18.0", "28.0", ...],
      "D1": ["0.0", "24.0", "28.0", ...],
      "L": ["35.0", "40.0", "45.0", ...],
      "l": ["8.0", "10.0", "12.0", ...],
      "r": ["0.1", "0.2", "0.3"],
      "c": ["0.6", "1.0"],
      "c1": ["0.5", "1.0", "1.2"]
    }
  }
}
```

### Логика валидации

Массив "Var" представляет собой таблицу размером 12 столбцов на N строк (где N — количество допустимых конфигураций). Каждая строка содержит одну допустимую комбинацию всех 12 параметров.

При выборе пользователем значения для одного параметра система:
1. Проходит по всем строкам таблицы "Var"
2. Находит строку, где значение в соответствующей колонке совпадает с выбранным
3. Устанавливает значения остальных параметров из найденной строки

Это обеспечивает гарантию физической и технологической совместимости всех компонентов.

## Архитектура и принципы проектирования

### Паттерны проектирования

Приложение построено с использованием нескольких признанных паттернов проектирования:

1. **Model-View-Controller (MVC)**: Архитектура основана на разделении между моделью данных (CKursachDoc), представлением (CKursachView) и контроллером (система диалогов)

2. **Builder Pattern**: Классы CMuftaBuilder, CValBuilder и их аналоги реализуют паттерн Builder для пошагового конструирования сложных объектов

3. **Singleton-подобная структура**: Объект пКомпасаОМ5 используется как глобальный единый экземпляр для взаимодействия с КОМПАС-3D

4. **Strategy Pattern**: Различные строители реализуют единый интерфейс построения с собственными алгоритмами

### Разделение ответственности

- **Builders**: Отвечают исключительно за генерацию трёхмерной геометрии
- **Objects/Dialogs**: Управляют пользовательским интерфейсом и взаимодействием с пользователем
- **Data Models**: Осуществляют сохранение и восстановление состояния
- **Core Application**: Координирует взаимодействие между компонентами

## Обработка ошибок и диагностика

Приложение реализует многоуровневую систему обработки ошибок:

- **JSON Parsing Errors**: При ошибке чтения файла `mufta_data.json` система перехватывает исключение std::exception и выводит диагностическое сообщение
- **KOMPAS API Failures**: Проверяются коды возврата HRESULT для всех вызовов COM-методов
- **File I/O Errors**: Контролируется наличие файлов и доступность директорий
- **Parameter Validation**: Проверяется наличие выбранных компонентов перед генерацией
- **Directory Creation**: Система автоматически создаёт необходимые директории с обработкой ошибок

Все ошибки сообщаются пользователю через модальные диалоговые окна с описанием проблемы и кода ошибки (при наличии).

## Технические заметки для разработчиков

### Особенности реализации

- **Набор символов**: По всему коду используется UNICODE для обеспечения поддержки кириллицы
- **Предкомпилируемые заголовки**: Включены для ускорения процесса компиляции
- **Динамическое управление памятью**: Таблица параметров муфт загружается динамически с использованием malloc/free
- **Исключения в JSON**: Парсер использует исключения для сигнализации об ошибках
- **COM-интеграция**: Требуется инициализация COM через AfxOleInit()
- **Потокобезопасность**: Приложение работает в едином потоке UI

### Жизненный цикл приложения

1. `Kursach.cpp::InitInstance()` - Инициализация COM, MFC и создание главного окна
2. `CKursachDoc` создаёт и инициализирует документ
3. `CKursachView` устанавливает кнопку "Построить"
4. При нажатии кнопки вызывается `StartKompas()`:
   - Проверка директорий
   - Получение/создание COM-объекта КОМПАС
   - Создание деталей через Builders
   - Сборка компонентов
5. При закрытии приложения освобождаются все ресурсы

### Расширяемость

Для добавления новых типов компонентов необходимо:
1. Создать новый класс Builder, наследующий базовый интерфейс
2. Реализовать метод `Build()` с алгоритмом построения
3. Добавить вызов нового Builder в `CreateDetails()`
4. Создать диалоговый класс для параметров нового компонента

## Философские размышления о проекте

Данный проект воплощает глубокую идею о природе инженерного творчества. Традиционно инженер мыслит в категориях чертежей и размеров, оперируя статичными объектами. Однако в момент, когда мы кодифицируем правила создания этих объектов, происходит качественный переход: инженер становится не просто проектировщиком, но архитектором смыслов и отношений.

Каждый параметр в таблице совместимости — это материализованное знание поколений инженеров, которые экспериментировали с различными комбинациями и выявили законы, управляющие взаимодействием компонентов. Когда мы кодируем эти законы в виде алгоритмов, мы совершаем акт трансформации эмпирического знания в формальное описание.

Это отражает более широкую тенденцию в современной науке и инженерии: переход от описания "что" к описанию "как" и "почему". Вместо простого представления готового изделия мы создаём генеративный процесс, который может производить бесконечное разнообразие вариаций в рамках установленных правил.

## Лицензирование и статус проекта

Данный проект разработан как учебное пособие (курсовая работа) в контексте инженерной подготовки. Он демонстрирует применение принципов объектно-ориентированного программирования, паттернов проектирования и интеграции с промышленными инструментами автоматизации проектирования.

Для коммерческого использования или лицензирования просим связаться с разработчиком.

## Техническая поддержка и контакты

При возникновении технических вопросов рекомендуется:
1. Проверить наличие всех зависимостей (особенно КОМПАС-3D)
2. Обратиться к официальной документации КОМПАС-3D API
3. Изучить логи в файле `DvlErrLog.txt`
4. Проверить целостность файла `mufta_data.json`

---

Последнее обновление: Декабрь 2025
Разработано как инструмент автоматизации проектирования механических узлов упругого соединения
Воплощение принципов параметрического проектирования и генеративного моделирования